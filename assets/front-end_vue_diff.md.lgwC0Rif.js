import{_ as s,o as i,c as a,R as n}from"./chunks/framework.0ARc0mp4.js";const l="/blog/assets/VNodeæ¯”è¾ƒ.7I1Rfh_K.png",p="/blog/assets/diffæµç¨‹å›¾.iuJvLjOP.png",e="/blog/assets/diffåˆ†æ_1.AGFeCr8Z.png",h="/blog/assets/diffåˆ†æ_2.vaFeYs8I.png",k="/blog/assets/diffåˆ†æ_3.PoViuvsk.png",t="/blog/assets/diffåˆ†æ_4.B1MOa1ZT.png",d="/blog/assets/diffåˆ†æ_5.Ky0Oyymw.png",r="/blog/assets/diffåˆ†æ_6.yjb45Pwo.png",C=JSON.parse('{"title":"Vueçš„Diffç®—æ³•","description":"","frontmatter":{"title":"Vueçš„Diffç®—æ³•"},"headers":[],"relativePath":"front-end/vue/diff.md","filePath":"front-end/vue/diff.md","lastUpdated":1715270350000}'),E={name:"front-end/vue/diff.md"},c=n('<p><code>Diff</code>ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯é’ˆå¯¹å…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„åŒå±‚æ–°æ—§å­èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨é€å±‚æœç´¢é€’å½’éå†çš„æ–¹å¼ã€‚æ—¶é—´å¤æ‚åº¦ä¸º<code>O(n)</code></p><p>è¯´ç™½ç‚¹ï¼Œå°±æ˜¯å½“æ–°æ—§<code>VNode</code>æ ‘åœ¨åŒä¸€å±‚å…·æœ‰ç›¸åŒçš„<code>VNode</code>èŠ‚ç‚¹æ—¶ï¼Œæ‰ä¼šç»§ç»­å¯¹å…¶å­èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚ä¸€æ—¦æ—§<code>VNode</code>æ ‘åŒå±‚ä¸­çš„èŠ‚ç‚¹åœ¨æ–°<code>VNode</code>æ ‘ä¸­ä¸å­˜åœ¨æˆ–è€…æ˜¯å¤šä½™çš„ï¼Œéƒ½ä¼šåœ¨æ–°çš„<code>çœŸå®DOM</code>ä¸­è¿›è¡Œæ·»åŠ æˆ–è€…åˆ é™¤</p><p>ä¸‹é¢å°±æ‹¿ä¸€å‰¯å›¾è¿›è¡Œè§£é‡Š</p><p><img src="'+l+'" alt="VNodeæ¯”è¾ƒ" loading="lazy" decoding="async"></p><p>ä»ä¸Šé¢çš„ç¤ºä¾‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œ<code>Diff</code>ç®—æ³•ä¸­åªä¼šå¯¹åŒä¸€å±‚çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”å¿…é¡»æ‹¥æœ‰ç›¸åŒèŠ‚ç‚¹å…ƒç´ ï¼Œæ‰ä¼šå¯¹å…¶å­èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œå…¶ä»–å¤šä½™çš„åŒå±‚èŠ‚ç‚¹éƒ½ä¼šä¸€å¾‹åšåˆ é™¤æˆ–æ·»åŠ æ“ä½œ</p><h2 id="diffæµç¨‹å›¾" tabindex="-1">Diffæµç¨‹å›¾ <a class="header-anchor" href="#diffæµç¨‹å›¾" aria-label="Permalink to &quot;Diffæµç¨‹å›¾&quot;">â€‹</a></h2><p>å½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œ<code>set</code>æ–¹æ³•ä¼šè°ƒç”¨<code>Dep.notify</code>é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…<code>Watcher</code>ï¼Œè®¢é˜…è€…å°±ä¼šè°ƒç”¨<code>patch</code>ç»™çœŸå®çš„ DOM æ‰“è¡¥ä¸ï¼Œæ›´æ–°ç›¸åº”çš„è§†å›¾</p><p><img src="'+p+`" alt="diffæµç¨‹å›¾" loading="lazy" decoding="async"></p><h2 id="ä»æºç è§’åº¦è¿›è¡Œæ¢ç©¶" tabindex="-1">ä»æºç è§’åº¦è¿›è¡Œæ¢ç©¶ <a class="header-anchor" href="#ä»æºç è§’åº¦è¿›è¡Œæ¢ç©¶" aria-label="Permalink to &quot;ä»æºç è§’åº¦è¿›è¡Œæ¢ç©¶&quot;">â€‹</a></h2><p>æˆ‘ä»¬ä¾ç„¶æ˜¯ä»<code>_update</code>æ–¹æ³•å…¥æ‰‹ï¼Œçœ‹çœ‹åˆ°åº•æ˜¯å¦‚ä½•æ“ä½œçš„</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vnode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hydrating</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Component</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ç¼“å­˜vueå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prevEl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.$el </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–å®ä¾‹ä¸­çœŸå®DOMå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prevVnode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm._vnode </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–æ—§VNodeæ ‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> restoreActiveInstance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setActiveInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vm._vnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å°†æ–°VNodeæ ‘ä¿å­˜åˆ°å®ä¾‹çš„_vnodeä¸Šï¼Œä¾¿äºä¸‹æ¬¡æ›´æ–°è·å–æ—§VNodeæ ‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ¤æ–­æ˜¯å¦æœ‰æ—§VNodeæ ‘ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prevVnode) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // initial render</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æœ€å¼€å§‹çš„ä¸€æ¬¡ï¼Œå³ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶æ˜¯æ²¡æœ‰æ—§VNodeæ ‘ï¼Œç›´æ¥æ‰§è¡Œ__patch__</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vm.$el </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">__patch__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.$el, vnode, hydrating, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* removeOnly */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // updates</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ–°VNodeæ ‘ä¸æ—§VNodeæ ‘è¿›è¡Œ__patch__</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vm.$el </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">__patch__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prevVnode, vnode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // çœç•¥ä¸€ç³»åˆ—å…¶å®ƒä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>æ¯ä¸€æ¬¡æ›´æ–°æ¨¡æ¿æ—¶ï¼Œéƒ½ä¼šå…ˆå°†æ¸²æŸ“å¥½çš„æ–°<code>VNode</code>æ ‘ä¿å­˜åˆ°å®ä¾‹çš„<code>_vnode</code>å±æ€§ä¸Šï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¸‹ä¸€æ¬¡æ›´æ–°æ—¶ï¼Œèƒ½è·å–åˆ°æ—§<code>VNode</code>æ ‘è¿›è¡Œæ¯”è¾ƒ</p><p>é’ˆå¯¹æ˜¯å¦æ‹¥æœ‰æ—§çš„<code>VNode</code>æ ‘ï¼Œä½¿ç”¨<code>__patch__</code>æ–¹æ³•æ‰§è¡Œç›¸åº”é€»è¾‘ï¼Œä¹Ÿå³æ‰§è¡Œäº†<code>patch</code>è¿‡ç¨‹</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inBrowser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;undefined&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æµè§ˆå™¨ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__patch__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inBrowser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> noop </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åªæœ‰åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰èƒ½è¿›è¡Œpatch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> patch</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPatchFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ nodeOps, modules })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰åœ¨æµè§ˆå™¨çš„ç¯å¢ƒä¸‹æ‰èƒ½è¿›è¡Œ<code>patch</code>è¿‡ç¨‹ï¼Œè€Œå®ç°<code>patch</code>çš„ï¼Œå°±æ˜¯<code>createPatchFunction</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ä¸‹å»</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPatchFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // çœç•¥äº†å¾ˆå¤šç§æœ‰å·¥å…·æ–¹æ³•ï¼Œä¸‹é¢ä¼šæ‹¿å‡ºä¸€äº›è¿›è¡Œè¯´æ˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> patch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">oldVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hydrating</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removeOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“æ—§VNodeæ ‘ä¸å­˜åœ¨æ—¶ï¼Œåˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªæ ¹å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // empty mount (likely as component), create new root element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      isInitialPatch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      createElm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vnode, insertedVnodeQueue) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›´æ¥æ ¹æ®æ–°VNodeæ ‘å¹¶ç”ŸæˆçœŸå®DOM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“å­˜åœ¨æ—§VNodeæ ‘æ—¶ï¼Œåˆ™è¿›è¡Œç›¸åº”çš„æ¯”è¾ƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isRealElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode.nodeType)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isRealElement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode, vnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ–°æ—§èŠ‚ç‚¹æ˜¯ç›¸åŒæ—¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // patch existing root node</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å½“æ–°æ—§èŠ‚ç‚¹ç›¸åŒæ—¶åˆ™è¿›è¡Œpatchæ¯”è¾ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode, vnode, insertedVnodeQueue, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, removeOnly)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ–°æ—§èŠ‚ç‚¹ä¸ç›¸åŒæ—¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // replacing existing element</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> oldElm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldVnode.elm </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–æ—§èŠ‚ç‚¹å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> parentElm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parentNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldElm) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–æ—§èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // create new node</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç”±äºæ–°æ—§èŠ‚ç‚¹æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ä¼šæ ¹æ®æ–°èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        createElm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          vnode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          insertedVnodeQueue,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          oldElm._leaveCb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parentElm,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextSibling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldElm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // destroy old node</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentElm)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // åˆ›å»ºå¥½æ–°èŠ‚ç‚¹åï¼Œåˆ é™¤æ—§èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          removeVnodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([oldVnode], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode.tag)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // åˆ é™¤å“åº”èŠ‚ç‚¹åï¼Œä¹Ÿä¼šè°ƒç”¨ç›¸åº”çš„å›è°ƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          invokeDestroyHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    invokeInsertHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vnode, insertedVnodeQueue, isInitialPatch)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode.elm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>å¥½å•¦ï¼Œå¯¹äº<code>patch</code>æ¯”è¾ƒè¿‡ç¨‹ï¼Œä½ ä¹Ÿåº”è¯¥æœ‰äº†ä¸€ä¸ªå¤§æ¦‚äº†è§£ã€‚ç°åœ¨å°±æ¥ç®€å•æ€»ç»“ä¸€ä¸‹ä¸Šè¿°ä»£ç </p><ul><li>å½“æ—§<code>VNode</code>æ ‘ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥æ ¹æ®æ–°<code>VNode</code>æ ‘åˆ›å»ºç›¸åº”çš„<code>çœŸå®DOM</code></li><li>å½“æ—§<code>VNode</code>æ ‘å­˜åœ¨æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨<code>sameVnode</code>æ–¹æ³•æ¯”è¾ƒå½“å‰æ–°æ—§èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ <ul><li>å½“æ–°æ—§èŠ‚ç‚¹æ˜¯ç›¸åŒæ—¶ï¼Œä¼šè°ƒç”¨<code>patchVnode</code>æ–¹æ³•æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹ï¼ˆè¿‡ç¨‹å°±æ˜¯ç»§ç»­æ¯”è¾ƒå…¶å­èŠ‚ç‚¹ï¼Œé€’å½’ä¸‹å»ï½ï¼‰</li><li>å½“æ–°æ—§èŠ‚ç‚¹æ˜¯ä¸åŒæ—¶ï¼Œåˆ™ä¼šå…ˆæŒ‰ç…§æ–°<code>VNode</code>èŠ‚ç‚¹åˆ›å»ºæ–°çš„çœŸå® DOM èŠ‚ç‚¹ï¼Œå†æ ¹æ®æ—§<code>VNode</code>èŠ‚ç‚¹å°†ç›¸åº”çš„çœŸå® DOM èŠ‚ç‚¹è¿›è¡Œåˆ é™¤</li></ul></li></ul><p>æ˜¯ä¸æ˜¯å¾ˆç®€å• ğŸ¤”...é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸æ˜¯è¯´<code>patch</code>è¿‡ç¨‹æ˜¯ä½¿ç”¨<code>Diff</code>ç®—æ³•è¿›è¡Œæ¯”è¾ƒçš„å—ï¼Ÿæ€ä¹ˆè¿˜çœ‹ä¸åˆ°ï¼Œç”­æ€¥ï¼Œä¸‹é¢æˆ‘ä¼šè®²åˆ°å“ˆ</p><p>åœ¨ä¸Šé¢çš„æ€»ç»“ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>sameVnode</code>æ–¹æ³•å’Œ<code>patchVnode</code>æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•</p><h2 id="samevnode" tabindex="-1"><code>sameVnode</code> <a class="header-anchor" href="#samevnode" aria-label="Permalink to &quot;\`sameVnode\`&quot;">â€‹</a></h2><p>åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹é—´æ˜¯å¦ç›¸åŒ</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹é—´æ˜¯å¦ç›¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä¸¤ä¸ªèŠ‚ç‚¹è‹¥ç›¸åŒï¼Œé¦–å…ˆæ˜¯å”¯ä¸€æ ‡è¯†keyå¿…é¡»ç›¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    a.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    a.asyncFactory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.asyncFactory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ((a.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      a.isComment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.isComment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b.data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // æ¥ç€å°±æ˜¯èŠ‚ç‚¹æ ‡ç­¾åã€æ˜¯å¦ä¸ºæ³¨é‡Šã€æ•°æ®æ˜¯å¦ä¸ºç©ºã€inputç±»å‹éƒ½å¿…é¡»ç›¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      sameInputType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a, b)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.isAsyncPlaceholder) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b.asyncFactory.error)))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sameInputType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹çš„inputç±»å‹æ˜¯å¦ç›¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (a.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;input&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> typeA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.data)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.attrs)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> typeB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.data)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.attrs)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typeA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typeB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isTextInputType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(typeA) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isTextInputType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(typeB))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>æ¯”è¾ƒä¸¤ä¸ªæ–°æ—§èŠ‚ç‚¹é—´æ˜¯å¾ˆç®€å•çš„ï¼Œä¸»è¦æ˜¯æŒ‰ç…§ä¸‹é¢å‡ ä¸ªå±æ€§è¿›è¡Œåˆ¤æ–­</p><ul><li><code>VNode</code>èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†<code>key</code></li><li>æ˜¯å¦åŒä¸ºæ³¨é‡Š<code>isComment</code></li><li>æ•°æ®å±æ€§æ˜¯å¦ä¸ºç©º<code>isDef</code></li><li>æ˜¯å¦ä¸ºç›¸åŒçš„<code>input</code>ç±»å‹<code>sameInputType</code></li></ul><h2 id="patchvnode" tabindex="-1"><code>patchVnode</code> <a class="header-anchor" href="#patchvnode" aria-label="Permalink to &quot;\`patchVnode\`&quot;">â€‹</a></h2><p>å¥½å•¦ï¼Œæ¥ç€å°±åˆ°æˆ‘ä»¬çš„ä¸»è§’<code>patchVnode</code>æ–¹æ³•äº†ï¼Œè¿™ä¸ªæ‰æ˜¯<code>Diff</code>ç›¸å…³æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æºç æ˜¯å¦‚ä½•å®ç°çš„</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">oldVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">insertedVnodeQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ownerArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removeOnly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å½“å‘ç°ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å®Œå…¨ä¸€æ¨¡ä¸€æ ·æ—¶ï¼Œåˆ™ç›´æ¥è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vnode.elm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldVnode.elm)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode.data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.hook)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.prepatch))) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode, vnode) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¹æ®æ–°VNodeæ›´æ–°æ—§VNodeçš„é€‰é¡¹é…ç½®ã€æ•°æ®å±æ€§ã€propsDataç­‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> oldCh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldVnode.children </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–oldVNodeçš„å­èŠ‚ç‚¹é›†åˆ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ch</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode.children </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–VNodeçš„å­èŠ‚ç‚¹é›†åˆ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vnode.text)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å½“VNodeä¸ä¸ºæ–‡æœ¬èŠ‚ç‚¹æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldCh) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ch)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“oldVNodeçš„å­èŠ‚ç‚¹å’ŒVNodeçš„å­èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºæ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldCh </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ch)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å½“oldVNodeçš„å­èŠ‚ç‚¹å’ŒVNodeçš„å­èŠ‚ç‚¹ä¸ç­‰æ—¶ï¼Œå†é€’å½’æ‰§è¡ŒupdateChildrenæ¯”è¾ƒå­èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        updateChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ch)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“åªæœ‰VNodeçš„å­èŠ‚ç‚¹å­˜åœ¨è€ŒoldVNodeçš„å­èŠ‚ç‚¹ä¸å­˜åœ¨æ—¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“oldVNodeä¸ºæ–‡æœ¬èŠ‚ç‚¹æ—¶ï¼Œå…ˆç½®ç©ºæ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode.text)) nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTextContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elm, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      addVnodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elm, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ch, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ch.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, insertedVnodeQueue) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¹æ®ä½ç½®å¯¹çœŸå®DOMæ·»åŠ æ–°çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldCh)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“oldVNodeçš„å­èŠ‚ç‚¹å­˜åœ¨, è€ŒVNodeçš„å­èŠ‚ç‚¹ä¸å­˜åœ¨æ—¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      removeVnodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldCh, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, oldCh.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›´æ¥ç§»é™¤æ‰€æœ‰å¤šä½™èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldVnode.text)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“åªæœ‰oldVNodeçš„å­èŠ‚ç‚¹å­˜åœ¨,å¹¶ä¸”æ˜¯æ–‡æœ¬èŠ‚ç‚¹æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTextContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elm, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›´æ¥ç½®ç©ºæ–‡æœ¬å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldVnode.text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vnode.text) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å½“oldVNodeæ–‡æœ¬èŠ‚ç‚¹ä¸ç­‰äºVNodeæ–‡æœ¬èŠ‚ç‚¹æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTextContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elm, vnode.text) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›´æ¥å°†oldVNodeèŠ‚ç‚¹è®¾ç½®ä¸ºVNodeèŠ‚ç‚¹æ–‡æœ¬å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><code>patchVnode</code>æ–¹æ³•åšçš„äº‹æƒ…ä¸å¤šï¼Œæœ€ä¸»è¦å°±æ˜¯æŒ‰ç…§ä¸€ä¸‹åœºæ™¯åšäº†å¤„ç†</p><p><code>diff</code>è¿‡ç¨‹ä¸­åˆåˆ†äº†å¥½å‡ ç§æƒ…å†µï¼Œ<code>oldCh</code>ä¸º<code>oldVnode</code>çš„å­èŠ‚ç‚¹ï¼Œ<code>ch</code>ä¸º<code>Vnode</code>çš„å­èŠ‚ç‚¹ï¼š</p><ul><li>é¦–å…ˆè¿›è¡Œæ–‡æœ¬èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œè‹¥<code>oldVnode.text !== vnode.text</code>ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œæ–‡æœ¬èŠ‚ç‚¹çš„æ›¿æ¢</li><li>åœ¨<code>vnode</code>æ²¡æœ‰æ–‡æœ¬èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œè¿›å…¥å­èŠ‚ç‚¹çš„<code>diff</code></li><li>å½“<code>oldCh</code>å’Œ<code>ch</code>éƒ½å­˜åœ¨ä¸”ä¸ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨<code>updateChildren</code>å¯¹å­èŠ‚ç‚¹è¿›è¡Œ<code>diff</code></li><li>è‹¥<code>oldCh</code>ä¸å­˜åœ¨ï¼Œ<code>ch</code>å­˜åœ¨ï¼Œé¦–å…ˆæ¸…ç©º<code>oldVnode</code>çš„æ–‡æœ¬èŠ‚ç‚¹ï¼ŒåŒæ—¶è°ƒç”¨<code>addVnodes</code>æ–¹æ³•å°†<code>ch</code>æ·»åŠ åˆ°<code>elm</code>çœŸå® DOM èŠ‚ç‚¹å½“ä¸­</li><li>è‹¥<code>oldCh</code>å­˜åœ¨ï¼Œ<code>ch</code>ä¸å­˜åœ¨ï¼Œåˆ™åˆ é™¤<code>elm</code>çœŸå® DOM èŠ‚ç‚¹ä¸‹çš„<code>oldCh</code>å­èŠ‚ç‚¹</li><li>è‹¥<code>oldVnode</code>æœ‰æ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œ<code>vnode</code>æ²¡æœ‰ï¼Œé‚£ä¹ˆå°±æ¸…ç©ºè¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹</li></ul><p>æ¥ä¸‹æ¥æ‰æ˜¯æœ€é‡ç‚¹å‘€ã€‚ã€‚ğŸ˜… åœ¨ä¸Šé¢ä¸­ç•™ä¸‹äº†<code>updateChildren</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åˆæ˜¯å¹²å•¥</p><p>ä¸ç’ä½ è¯´ï¼Œ<code>updateChildren</code>æ–¹æ³•åœ¨æ ¹æ®åœºæ™¯<code>Diff</code>åï¼Œå°†<code>oldVNode</code>æ ‘ä½œå‡ºç›¸åº”çš„æ”¹åŠ¨ã€‚åœ¨æ²¡æœ‰çœ‹æºç ä¹‹å‰ï¼Œæˆ‘ä¼šå…ˆé˜è¿°ä¸€ä¸‹</p><p><code>Diff</code>ç®—æ³•è¿‡ç¨‹ä¸­ï¼Œåœ¨å°†<code>oldVNode</code>æ ‘æ”¹åŠ¨æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ç›¸åŒä½ç½®çš„ç›¸åŒèŠ‚ç‚¹ï¼Œå†è€ƒè™‘éœ€è¦ç§»åŠ¨çš„ç›¸åŒèŠ‚ç‚¹ï¼Œæœ€åæ‰è€ƒè™‘åˆ›å»ºæˆ–åˆ é™¤èŠ‚ç‚¹</p><h2 id="updatechildren" tabindex="-1"><code>updateChildren</code> <a class="header-anchor" href="#updatechildren" aria-label="Permalink to &quot;\`updateChildren\`&quot;">â€‹</a></h2><p>æœ‰äº†ä¸Šé¢çš„ç®€å•ç†è§£ï¼Œæˆ‘ä»¬å°±æ¥ç»§ç»­æ¢ç©¶å•¦ ğŸ˜„</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parentElm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">oldCh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">newCh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">insertedVnodeQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removeOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æ—§èŠ‚ç‚¹å¼€å§‹ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æ–°èŠ‚ç‚¹å¼€å§‹ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldEndIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æ—§èŠ‚ç‚¹ç»“æŸä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—§èŠ‚ç‚¹ç¬¬ä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[oldEndIdx] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—§èŠ‚ç‚¹æœ€åä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newEndIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æ–°èŠ‚ç‚¹ç»“æŸä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–°èŠ‚ç‚¹ç¬¬ä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[newEndIdx] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–°èŠ‚ç‚¹æœ€åä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldKeyToIdx, idxInOld, vnodeToMove, refElm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åŒæ—¶ä»æ–°æ—§å­èŠ‚ç‚¹é›†åˆå¼€å§‹éå†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldEndIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newEndIdx) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldStartVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä»ç¬¬ä¸€é¡¹å¼€å§‹ï¼Œä¸€ç›´éå†æ—§èŠ‚ç‚¹åˆå§‹å…ƒç´ ç›´åˆ°ä¸ä¸ºç©ºä¸ºæ­¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldStartIdx] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Vnode has been moved left</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä»æœ€åä¸€é¡¹å¼€å§‹ï¼Œä¸€ç›´éå†æ—§èŠ‚ç‚¹ç›´åˆ°ä¸ä¸ºç©ºä¸ºæ­¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldEndIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldStartVnode, newStartVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ï¼ˆç›¸åŒä½ç½®åœºæ™¯ï¼‰å½“ç¬¬ä¸€é¡¹æ—§èŠ‚ç‚¹å’Œç¬¬ä¸€é¡¹æ–°èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œåˆ™ç»§ç»­æ‰§è¡ŒpatchVnodeé€’å½’æ‰§è¡Œä¸‹å»</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldStartIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      newStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newStartIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode, newEndVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ï¼ˆç›¸åŒä½ç½®åœºæ™¯ï¼‰å½“æœ€åä¸€é¡¹æ—§èŠ‚ç‚¹å’Œæœ€åä¸€é¡¹æ–°èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œåˆ™ç»§ç»­æ‰§è¡ŒpatchVnodeé€’å½’æ‰§è¡Œä¸‹å»</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldEndIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      newEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newEndIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldStartVnode, newEndVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ï¼ˆéœ€è¦ç§»åŠ¨åœºæ™¯ï¼‰å½“ç¬¬ä¸€é¡¹æ—§èŠ‚ç‚¹å’Œæœ€åä¸€é¡¹æ–°èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œå…ˆæ‰§è¡ŒpatchVnodeé€’å½’æ‰§è¡Œä¸‹å»ï¼Œå†æ‰§è¡ŒinsertBeforeå°†çœŸå®DOMèŠ‚ç‚¹æ’å…¥åˆ°ç›¸åº”ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      canMove </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentElm, oldStartVnode.elm, nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextSibling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode.elm))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldStartIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      newEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newEndIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode, newStartVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ï¼ˆéœ€è¦ç§»åŠ¨åœºæ™¯ï¼‰å½“æœ€åä¸€é¡¹æ—§èŠ‚ç‚¹å’Œç¬¬ä¸€é¡¹æ–°èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œå…ˆæ‰§è¡ŒpatchVnodeé€’å½’æ‰§è¡Œä¸‹å»ï¼Œå†æ‰§è¡ŒinsertBeforeå°†çœŸå®DOMèŠ‚ç‚¹æ’å…¥åˆ°ç›¸åº”ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      canMove </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentElm, oldEndVnode.elm, oldStartVnode.elm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oldEndVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">oldEndIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      newStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newStartIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // æ¯”è¾ƒå¤´å°¾éƒ½æ— ç›¸åŒå…ƒç´ æ—¶ï¼Œç›´æ¥åˆ¤æ–­æ–°èŠ‚ç‚¹æ˜¯å¦åœ¨æ—§èŠ‚ç‚¹ç»“åˆä¸­ï¼Œè‹¥æœ‰åˆ™ç›´æ¥ç§»åŠ¨ç›¸åº”çš„ä½ç½®ï¼Œè‹¥æ— åˆ™ç›´æ¥æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldKeyToIdx)) oldKeyToIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createKeyToOldIdx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldCh, oldStartIdx, oldEndIdx) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å°†æ—§èŠ‚ç‚¹ç»“åˆåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      idxInOld </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isDef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newStartVnode.key)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldKeyToIdx[newStartVnode.key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> findIdxInOld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newStartVnode, oldCh, oldStartIdx, oldEndIdx) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¹æ®å“ˆå¸Œè¡¨ï¼Œåˆ¤æ–­æ–°èŠ‚ç‚¹æ˜¯å¦åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå¹¶è·å¾—å¯¹åº”æ—§èŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(idxInOld)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å½“æ–°èŠ‚ç‚¹ä¸åœ¨æ—§èŠ‚ç‚¹é›†åˆä¸­æ—¶ï¼Œæ–°å»ºä¸€ä¸ªçœŸå®DOMèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        createElm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          newStartVnode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          insertedVnodeQueue,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          parentElm,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          oldStartVnode.elm,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          newCh,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          newStartIdx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å½“æ–°èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹é›†åˆä¸­æ—¶ï¼Œåˆ™ä¼šå…ˆåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vnodeToMove </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldCh[idxInOld] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¹æ®ç´¢å¼•ä½ç½®è·å¾—æ—§èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sameVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vnodeToMove, newStartVnode)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // å½“ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯ç›¸åŒæ—¶ï¼Œç»§ç»­æ‰§è¡ŒpatchVnodeé€’å½’æ‰§è¡Œä¸‹å»ï¼Œå†æ‰§è¡ŒinsertBeforeå°†çœŸå®DOMèŠ‚ç‚¹æ’å…¥åˆ°ç›¸åº”ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          patchVnode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          oldCh[idxInOld] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          canMove </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nodeOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentElm, vnodeToMove.elm, oldStartVnode.elm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // å½“ä¸¤ä¸ªèŠ‚ç‚¹ä¸åŒæ—¶ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªæ–°çš„DOMèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // same key but different element. treat as new element</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          createElm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            newStartVnode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            insertedVnodeQueue,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            parentElm,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            oldStartVnode.elm,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            newCh,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            newStartIdx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      newStartVnode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newStartIdx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·³å‡ºå¾ªç¯åï¼Œè‹¥æ–°èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¦éå†å‰©ä½™çš„æ–°èŠ‚ç‚¹å¹¶é€ä¸ªæ–°å¢åˆ°çœŸå®DOMä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldEndIdx) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refElm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isUndef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newCh[newEndIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newCh[newEndIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].elm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    addVnodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (newStartIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newEndIdx) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·³å‡ºå¾ªç¯åï¼Œè‹¥æ—§èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¦å°†çœŸå®DOMä¸­å¯¹åº”æ—§VNodeèŠ‚ç‚¹è¿›è¡Œåˆ é™¤æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    removeVnodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(oldCh, oldStartIdx, oldEndIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><h2 id="å…·ä½“çš„diffåˆ†æ" tabindex="-1">å…·ä½“çš„diffåˆ†æ <a class="header-anchor" href="#å…·ä½“çš„diffåˆ†æ" aria-label="Permalink to &quot;å…·ä½“çš„diffåˆ†æ&quot;">â€‹</a></h2><p>æˆ‘ä»¬å¯ä»¥å‡è®¾æœ‰æ—§çš„<code>Vnode</code>æ•°ç»„å’Œæ–°çš„<code>Vnode</code>æ•°ç»„è¿™ä¸¤ä¸ªæ•°ç»„ï¼Œè€Œä¸”æœ‰å››ä¸ªå˜é‡å……å½“æŒ‡é’ˆåˆ†åˆ«æŒ‡åˆ°ä¸¤ä¸ªæ•°ç»„çš„å¤´å°¾</p><p>é‡å¤ä¸‹é¢çš„å¯¹æ¯”è¿‡ç¨‹ï¼Œç›´åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­ä»»ä¸€æ•°ç»„çš„å¤´æŒ‡é’ˆè¶…è¿‡å°¾æŒ‡é’ˆï¼Œå¾ªç¯ç»“æŸ</p><ul><li><strong>å¤´å¤´å¯¹æ¯”</strong>: å¯¹æ¯”ä¸¤ä¸ªæ•°ç»„çš„å¤´éƒ¨ï¼Œå¦‚æœæ‰¾åˆ°ï¼ŒæŠŠæ–°èŠ‚ç‚¹<code>patch</code>åˆ°æ—§èŠ‚ç‚¹ï¼Œå¤´æŒ‡é’ˆåç§»</li><li><strong>å°¾å°¾å¯¹æ¯”</strong>: å¯¹æ¯”ä¸¤ä¸ªæ•°ç»„çš„å°¾éƒ¨ï¼Œå¦‚æœæ‰¾åˆ°ï¼ŒæŠŠæ–°èŠ‚ç‚¹<code>patch</code>åˆ°æ—§èŠ‚ç‚¹ï¼Œå°¾æŒ‡é’ˆå‰ç§»</li><li><strong>æ—§å°¾æ–°å¤´å¯¹æ¯”</strong>: äº¤å‰å¯¹æ¯”ï¼Œæ—§å°¾æ–°å¤´ï¼Œå¦‚æœæ‰¾åˆ°ï¼ŒæŠŠæ–°èŠ‚ç‚¹<code>patch</code>åˆ°æ—§èŠ‚ç‚¹ï¼Œæ—§å°¾æŒ‡é’ˆå‰ç§»ï¼Œæ–°å¤´æŒ‡é’ˆåç§»</li><li><strong>æ—§å¤´æ–°å°¾å¯¹æ¯”</strong>: äº¤å‰å¯¹æ¯”ï¼Œæ—§å¤´æ–°å°¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼ŒæŠŠæ–°èŠ‚ç‚¹<code>patch</code>åˆ°æ—§èŠ‚ç‚¹ï¼Œæ–°å°¾æŒ‡é’ˆå‰ç§»ï¼Œæ—§å¤´æŒ‡é’ˆåç§»</li><li><strong>åˆ©ç”¨<code>key</code>å¯¹æ¯”</strong>: ç”¨æ–°æŒ‡é’ˆå¯¹åº”èŠ‚ç‚¹çš„<code>key</code>å»æ—§æ•°ç»„å¯»æ‰¾å¯¹åº”çš„èŠ‚ç‚¹,è¿™é‡Œåˆ†ä¸‰ç§æƒ…å†µ <ul><li>å½“æ²¡æœ‰å¯¹åº”çš„<code>key</code>ï¼Œé‚£ä¹ˆåˆ›å»ºæ–°çš„èŠ‚ç‚¹</li><li>å¦‚æœæœ‰<code>key</code>å¹¶ä¸”æ˜¯ç›¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™æŠŠæ–°èŠ‚ç‚¹<code>patch</code>åˆ°æ—§èŠ‚ç‚¹</li><li>å¦‚æœæœ‰<code>key</code>ä½†æ˜¯ä¸æ˜¯ç›¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºæ–°èŠ‚ç‚¹</li></ul></li></ul><p>æˆ‘ä»¬å‡è®¾æœ‰æ–°æ—§ä¸¤ä¸ªæ•°ç»„</p><ul><li>æ—§æ•°ç»„: <code>[1, 2, 3, 4, 5]</code></li><li>æ–°æ•°ç»„: <code>[1, 4, 6, 1000, 100, 5]</code></li></ul><p><img src="`+e+'" alt="diffåˆ†æ1" loading="lazy" decoding="async"></p><blockquote><p>é¦–å…ˆæˆ‘ä»¬è¿›è¡Œå¤´å¤´å¯¹æ¯”ï¼Œæ–°æ—§æ•°ç»„çš„å¤´éƒ¨éƒ½æ˜¯<code>1</code>ï¼Œå› æ­¤å°†åŒæ–¹çš„å¤´éƒ¨æŒ‡é’ˆåç§»</p></blockquote><p><img src="'+h+'" alt="diffåˆ†æ2" loading="lazy" decoding="async"></p><blockquote><p>æˆ‘ä»¬ç»§ç»­å¤´å¤´å¯¹æ¯”ï¼Œå‘ç°<code>2 !== 4</code>å¯¼è‡´å¯¹æ¯”å¤±è´¥ï¼Œæˆ‘è¿›å…¥å°¾å°¾å¯¹æ¯”ï¼Œ<code>5 === 5</code>ï¼Œé‚£ä¹ˆå°¾éƒ¨æŒ‡é’ˆåˆ™å¯å‰ç§»</p></blockquote><p><img src="'+k+'" alt="diffåˆ†æ3" loading="lazy" decoding="async"></p><p>ç°åœ¨è¿›å…¥æ–°çš„å¾ªç¯ï¼Œå¤´å¤´å¯¹æ¯”<code>2 !== 4</code>ï¼Œå°¾å°¾å¯¹æ¯”<code>4 !== 100</code>ï¼Œæ­¤æ—¶è¿›å…¥äº¤å‰å¯¹æ¯”ï¼Œå…ˆè¿›è¡Œæ—§å°¾æ–°å¤´å¯¹æ¯”ï¼Œå³<code>4 === 4</code>ï¼Œæ—§å°¾å‰ç§»ä¸”æ–°å¤´åç§»</p><p><img src="'+t+'" alt="diffåˆ†æ4" loading="lazy" decoding="async"></p><p>æ¥ç€å†è¿›å…¥ä¸€ä¸ªæ–°çš„å¾ªç¯ï¼Œå¤´å¤´å¯¹æ¯”<code>2 !== 6</code>ï¼Œå°¾å°¾å¯¹æ¯”<code>3 !== 100</code>ï¼Œäº¤å‰å¯¹æ¯”<code>2 != 100</code> <code>3 != 6</code>ï¼Œå››ç§å¯¹æ¯”æ–¹å¼å…¨éƒ¨ä¸ç¬¦åˆï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦é€šè¿‡<code>key</code>å»å¯¹æ¯”ï¼Œç„¶åå°†æ–°å¤´æŒ‡é’ˆåç§»</p><p><img src="'+d+'" alt="diffåˆ†æ5" loading="lazy" decoding="async"></p><p>ç»§ç»­é‡å¤ä¸Šè¿°å¯¹æ¯”çš„å¾ªç¯æ–¹å¼ç›´è‡³ä»»ä¸€æ•°ç»„çš„å¤´æŒ‡é’ˆè¶…è¿‡å°¾æŒ‡é’ˆï¼Œå¾ªç¯ç»“æŸ</p><p><img src="'+r+'" alt="diffåˆ†æ6" loading="lazy" decoding="async"></p><p>åœ¨ä¸Šè¿°å¾ªç¯ç»“æŸåï¼Œä¸¤ä¸ªæ•°ç»„ä¸­å¯èƒ½å­˜åœ¨æœªéå†å®Œçš„æƒ…å†µ: å¾ªç¯ç»“æŸå</p><ul><li><strong>å…ˆå¯¹æ¯”æ—§æ•°ç»„çš„å¤´å°¾æŒ‡é’ˆï¼Œå¦‚æœæ—§æ•°ç»„éå†å®Œäº†ï¼ˆå¯èƒ½æ–°æ•°ç»„æ²¡éå†å®Œï¼Œæœ‰æ¼æ·»åŠ çš„é—®é¢˜ï¼‰ï¼Œæ·»åŠ æ–°æ•°ç»„ä¸­æ¼æ‰çš„èŠ‚ç‚¹</strong></li><li><strong>å†å¯¹æ¯”æ–°æ•°ç»„çš„å¤´å°¾æŒ‡é’ˆï¼Œå¦‚æœæ–°æ•°ç»„éå†å®Œäº†ï¼ˆå¯èƒ½æ—§æ•°ç»„æ²¡éå†å®Œï¼Œæœ‰æ¼åˆ é™¤çš„é—®é¢˜ï¼‰ï¼Œåˆ é™¤æ—§æ•°ç»„ä¸­æ¼æ‰çš„èŠ‚ç‚¹</strong></li></ul><h2 id="å‚è€ƒ" tabindex="-1">å‚è€ƒ <a class="header-anchor" href="#å‚è€ƒ" aria-label="Permalink to &quot;å‚è€ƒ&quot;">â€‹</a></h2><ul><li><a href="https://juejin.cn/post/6844903895467032589" target="_blank" rel="noreferrer">Vue æ ¸å¿ƒä¹‹è™šæ‹Ÿ DOM</a></li><li><a href="https://github.com/aooy/blog/issues/2" target="_blank" rel="noreferrer">è§£æ vue2.0 çš„ diff ç®—æ³•</a></li><li><a href="https://juejin.cn/post/6844903607913938951" target="_blank" rel="noreferrer">è¯¦è§£ vue çš„ diff ç®—æ³•</a></li><li><a href="https://juejin.cn/post/6844903902429577229#heading-5" target="_blank" rel="noreferrer">é¢è¯•å®˜: ä½ å¯¹è™šæ‹Ÿ DOM åŸç†çš„ç†è§£?</a></li><li><a href="https://github.com/Andraw-lin/about-Vue/blob/master/docs/%E3%80%90%20Vue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E3%80%91%E5%A6%82%E4%BD%95%E5%9C%A8%E6%9B%B4%E6%96%B0%20Patch%20%E4%B8%AD%E8%BF%9B%E8%A1%8C%20Diff.md" target="_blank" rel="noreferrer">ã€ Vue æºç åˆ†æ ã€‘å¦‚ä½•åœ¨æ›´æ–° Patch ä¸­è¿›è¡Œ Diff.md</a></li></ul>',58),g=[c];function y(o,b,F,D,m,u){return i(),a("div",null,g)}const f=s(E,[["render",y]]);export{C as __pageData,f as default};
